<!DOCTYPE html>
<meta charset="utf8"/>
<script src=../js/essential.js></script>
<script src=../js/sha256.js></script>
<script src=../js/ipfs.js></script>

<div>
network: <button id=join onclick="join(event)">join wlog</button> <span id=token></span>
<br>find: <button id=provs onclick="provs(event)">provs</button>
<div id=peerids></div>

<br>line: <input type=text name=record size=74>
<br><button id=append onclick="append(event)">append</button>
<button id=update onclick="update(event)">update</button>
</div>


<script>
const key='clef-secrete';
const label='a-big-log.txt';
const urn='urn:wwlog:'+label;
let nid= getNid(`${key},${urn}`);
var token;
var peerids;

main();
function main() {
  get_token(nid).then(t => {
   token = t;
   return ipfsFindProvs(token) })
  .then( (a) => { peerids = a; console.log('main.peerids',peerids); });
}

async function get_token(str) {
  let [callee, caller] = functionNameJS(); // logInfo("message !")
  token = await ipfsGetToken(str);
  console.debug(callee+'.token:',token);
  document.getElementById('token').innerHTML = token;
  return token
}


async function join(ev) {
  let [callee, caller] = functionNameJS(); // logInfo("message !")
  let token = await ipfsAddToken(nid);
  console.debug(callee+'.token:',token);
  document.getElementById('token').innerHTML = `<a href=http://127.0.0.1:8080/ipfs/${token}>${token}</a>`;
}

async function provs(ev) {
  let [callee, caller] = functionNameJS(); // logInfo("message !")
  if (typeof(peerids) == 'undefined') {
    console.debug(callee+'.token:',token);
    peerids = await ipfsFindProvs(token);
  }
  let buf = '<ul>';
  for (peer of peerids) {
    buf += `<li><a href=http://127.0.0.1:8080/ipns/${peer}/>${peer}</a></li>\n`
  }
  buf += "</ul>\n";
  document.getElementById('peerids').innerHTML = buf;
  
}

async function append(ev) {
  let [callee, caller] = functionNameJS(); // logInfo("message !")
  let line = document.getElementsByName('record')[0].value;
    console.debug(callee+'.line:',line);
   
}
</script>

